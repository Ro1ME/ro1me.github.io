<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>程序插桩 | 小小Ro1ME</title><meta name="author" content="Ro1ME"><meta name="copyright" content="Ro1ME"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="程序插桩定义：往被测试程序中插入测试代码以达到测试目的的方法，插入的测试代码被称为探针。 方法：（测试代码插入的时间）  目标代码插桩 源代码插桩  目标代码插桩（动态程序分析方法）特点：不需要代码重新编译或者链接程序，并且目标代码的格式和具体的编程语言无关，主要和操作系统相关。 原理：直接修改二进制程序（无需源码），在程序运行平台和底层操作系统之间建立中间层，通过动态中间层（如Pin、Dynam">
<meta property="og:type" content="article">
<meta property="og:title" content="程序插桩">
<meta property="og:url" content="http://example.com/2025/03/20/%E7%A8%8B%E5%BA%8F%E6%8F%92%E6%A1%A9/index.html">
<meta property="og:site_name" content="小小Ro1ME">
<meta property="og:description" content="程序插桩定义：往被测试程序中插入测试代码以达到测试目的的方法，插入的测试代码被称为探针。 方法：（测试代码插入的时间）  目标代码插桩 源代码插桩  目标代码插桩（动态程序分析方法）特点：不需要代码重新编译或者链接程序，并且目标代码的格式和具体的编程语言无关，主要和操作系统相关。 原理：直接修改二进制程序（无需源码），在程序运行平台和底层操作系统之间建立中间层，通过动态中间层（如Pin、Dynam">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-03-20T02:46:14.710Z">
<meta property="article:modified_time" content="2025-03-20T03:12:07.748Z">
<meta property="article:author" content="Ro1ME">
<meta property="article:tag" content="FUZZ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "程序插桩",
  "url": "http://example.com/2025/03/20/%E7%A8%8B%E5%BA%8F%E6%8F%92%E6%A1%A9/",
  "image": "http://example.com/img/butterfly-icon.png",
  "datePublished": "2025-03-20T02:46:14.710Z",
  "dateModified": "2025-03-20T03:12:07.748Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ro1ME",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/03/20/%E7%A8%8B%E5%BA%8F%E6%8F%92%E6%A1%A9/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '程序插桩',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">小小Ro1ME</span></a><a class="nav-page-title" href="/"><span class="site-name">程序插桩</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">程序插桩</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-03-20T02:46:14.710Z" title="发表于 2025-03-20 10:46:14">2025-03-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-03-20T03:12:07.748Z" title="更新于 2025-03-20 11:12:07">2025-03-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/">技术原理学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="程序插桩"><a href="#程序插桩" class="headerlink" title="程序插桩"></a>程序插桩</h2><p>定义：往被测试程序中插入测试代码以达到测试目的的方法，插入的测试代码被称为探针。</p>
<p>方法：（测试代码插入的时间）</p>
<ol>
<li>目标代码插桩</li>
<li>源代码插桩</li>
</ol>
<h3 id="目标代码插桩（动态程序分析方法）"><a href="#目标代码插桩（动态程序分析方法）" class="headerlink" title="目标代码插桩（动态程序分析方法）"></a>目标代码插桩（动态程序分析方法）</h3><p>特点：不需要代码重新编译或者链接程序，并且目标代码的格式和具体的编程语言无关，主要和操作系统相关。</p>
<p>原理：直接修改二进制程序（无需源码），在程序运行平台和底层操作系统之间建立中间层，通过动态中间层（如Pin、DynamoRIO）插入探针代码，监控内存、指令执行等</p>
<h4 id="工具示例"><a href="#工具示例" class="headerlink" title="工具示例"></a>工具示例</h4><ul>
<li>Pin（Intel开发）：用于动态二进制分析，支持指令跟踪、缓存模拟等，常用于大型软件（如Office）测试。</li>
<li>DynamoRIO：支持实时代码转换，适用于内存调试和性能分析。</li>
</ul>
<h3 id="源代码插桩"><a href="#源代码插桩" class="headerlink" title="源代码插桩"></a>源代码插桩</h3><p>原理：在源代码编译前，通过词法、语法分析确定插桩位置，<strong>直接插入探针代码</strong>。例如在条件分支、循环或函数入口&#x2F;出口处插入日志或断言。</p>
<p>示例：C代码在第13行插入宏<code>ASSERT(y)</code>，用于检测除数是否为0：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ASSERT(y) <span class="keyword">if</span>(y)&#123; printf(<span class="string">&quot;出错文件：%s\n&quot;</span>, __FILE__); \</span></span><br><span class="line"><span class="meta">                        printf(<span class="string">&quot;在第%d行：\n&quot;</span>, __LINE__); \</span></span><br><span class="line"><span class="meta">                        printf(<span class="string">&quot;提示：除数不能为0！\n&quot;</span>); &#125;</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">    ASSERT(y == <span class="number">0</span>);  <span class="comment">// 插桩点：检测除数合法性</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, x / y);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当<code>y=0</code>时，插桩代码会触发错误提示.</p>
<h3 id="开源插桩工具"><a href="#开源插桩工具" class="headerlink" title="开源插桩工具"></a><strong>开源插桩工具</strong></h3><h4 id="动态二进制插桩"><a href="#动态二进制插桩" class="headerlink" title="动态二进制插桩"></a><strong>动态二进制插桩</strong></h4><ul>
<li><p><strong>Intel Pin</strong></p>
<ul>
<li><p><strong>特点</strong>：无需修改源码，通过运行时注入代码追踪程序执行路径，支持x86&#x2F;ARM&#x2F;MIPS等多架构。</p>
</li>
<li><p><strong>应用</strong>：性能分析（指令计数）、内存访问监控、安全漏洞检测。</p>
</li>
<li><p>示例命令：用于统计指令数或检测缓冲区溢出</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pin -t &lt;工具.so&gt; -- &lt;目标程序&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>项目地址</strong>：<a target="_blank" rel="noopener" href="https://www.wenxiaobai.com/chat/200006#">Intel Pin</a></p>
</li>
</ul>
</li>
<li><p><strong>Frida</strong></p>
<ul>
<li><p><strong>特点</strong>：跨平台动态插桩框架，支持Android&#x2F;iOS&#x2F;Windows，通过JavaScript脚本注入实现Hook。</p>
</li>
<li><p><strong>应用</strong>：移动端逆向工程（如Hook ART核心函数）、实时监控方法调用。</p>
</li>
<li><p>示例代码</p>
<p>：Hook Android的 <code>libart.so</code>函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">JavaScriptInterceptor</span>.<span class="title function_">attach</span>(<span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libart.so&quot;</span>, <span class="string">&quot;art_method_invoke&quot;</span>), &#123;</span><br><span class="line">  <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Method called: &quot;</span> + args[<span class="number">0</span>]); &#125;</span><br><span class="line">&#125;);  </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>项目地址</strong>：<a target="_blank" rel="noopener" href="https://www.wenxiaobai.com/chat/200006#">Frida</a></p>
</li>
</ul>
</li>
<li><p><strong>TinyInst</strong></p>
<ul>
<li><strong>特点</strong>：轻量级动态插桩库，仅对选定模块插桩，减少性能损耗，支持Windows&#x2F;Linux&#x2F;macOS。</li>
<li><strong>应用</strong>：模糊测试（如AFL++的覆盖率追踪）、模块级代码监控。</li>
<li><strong>项目地址</strong>：<a target="_blank" rel="noopener" href="https://www.wenxiaobai.com/chat/200006#">TinyInst</a></li>
</ul>
</li>
</ul>
<h4 id="静态源代码插桩"><a href="#静态源代码插桩" class="headerlink" title="静态源代码插桩"></a><strong>静态源代码插桩</strong></h4><ul>
<li><p><strong>JaCoCo（Java Code Coverage）</strong></p>
<ul>
<li><p><strong>特点</strong>：基于字节码插桩，生成代码覆盖率报告，支持行、分支、方法级覆盖率统计。</p>
</li>
<li><p><strong>应用</strong>：单元测试覆盖率分析，集成到Maven&#x2F;Gradle构建流程。</p>
</li>
<li><p>配置示例：在<code>pom.xml</code>中添加插件：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jacoco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jacoco-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>项目地址</strong>：<a target="_blank" rel="noopener" href="https://www.wenxiaobai.com/chat/200006#">JaCoCo</a></p>
</li>
</ul>
</li>
<li><p><strong>OpenTelemetry</strong></p>
<ul>
<li><p><strong>特点</strong>：跨语言遥测框架（支持Java&#x2F;Python&#x2F;Go），提供标准化指标、日志、跟踪数据收集。</p>
</li>
<li><p><strong>应用</strong>：分布式系统性能监控，与Prometheus&#x2F;Grafana集成。</p>
</li>
<li><p>示例：在Python中插桩HTTP请求耗时</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> opentelemetry <span class="keyword">import</span> trace</span><br><span class="line">tracer = trace.get_tracer(__name__)</span><br><span class="line"><span class="keyword">with</span> tracer.start_as_current_span(<span class="string">&quot;http_request&quot;</span>):</span><br><span class="line">    requests.get(<span class="string">&quot;https://example.com&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>项目地址</strong>：<a target="_blank" rel="noopener" href="https://www.wenxiaobai.com/chat/200006#">OpenTelemetry</a></p>
</li>
</ul>
</li>
</ul>
<h4 id="编译器级插桩"><a href="#编译器级插桩" class="headerlink" title="编译器级插桩"></a><strong>编译器级插桩</strong></h4><ul>
<li><p><strong>LLVM Sanitizer</strong></p>
<ul>
<li><p><strong>特点</strong>：基于LLVM中间表示的插桩，支持ASAN（内存检测）、UBSan（未定义行为检测）。</p>
</li>
<li><p><strong>应用</strong>：C&#x2F;C++程序内存错误检测（如堆溢出、释放后使用）。</p>
</li>
<li><p><strong>编译选项：</strong><code>clang -fsanitize=address -g program.c</code></p>
</li>
</ul>
</li>
<li><p><strong>AFL（American Fuzzy Lop）</strong></p>
<ul>
<li><strong>特点</strong>：覆盖率引导的模糊测试工具，通过插桩追踪边覆盖率优化测试用例生成。</li>
<li><strong>应用</strong>：漏洞挖掘（如触发程序崩溃路径）。</li>
<li>**插桩原理：**在编译时注入覆盖率统计代码，共享内存记录执行路径</li>
<li><strong>项目地址</strong>：<a target="_blank" rel="noopener" href="https://www.wenxiaobai.com/chat/200006#">AFL</a></li>
</ul>
</li>
</ul>
<h3 id="如何选择插桩方法"><a href="#如何选择插桩方法" class="headerlink" title="如何选择插桩方法"></a>如何选择插桩方法</h3><table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>推荐方法</strong></th>
<th><strong>工具示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>需高精度测试（有源码）</td>
<td>源代码插桩</td>
<td>GCC插桩、ASSERT宏</td>
</tr>
<tr>
<td>闭源程序分析</td>
<td>目标代码插桩</td>
<td>Pin、DynamoRIO</td>
</tr>
<tr>
<td>实时性能监控</td>
<td>动态二进制插桩</td>
<td>Frida、DynamoRIO</td>
</tr>
<tr>
<td>大规模覆盖率统计</td>
<td>自动化插桩工具</td>
<td>OpenTelemetry</td>
</tr>
</tbody></table>
<p>通过上述分类与示例可见，程序插桩是连接静态分析与动态执行的关键技术，广泛应用于软件工程的全生命周期。实际应用中需权衡精度、效率与侵入性，结合具体场景选择工具和策略。</p>
<h3 id="如何使用插桩工具"><a href="#如何使用插桩工具" class="headerlink" title="如何使用插桩工具"></a>如何使用插桩工具</h3><h4 id="第1步：选择工具"><a href="#第1步：选择工具" class="headerlink" title="第1步：选择工具"></a>第1步：选择工具</h4><p>常用工具及适用场景：</p>
<table>
<thead>
<tr>
<th>工具</th>
<th>特点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Intel Pin</strong></td>
<td>支持Windows&#x2F;Linux，适合指令级监控（如统计指令执行次数）</td>
<td>性能分析、漏洞挖掘</td>
</tr>
<tr>
<td><strong>DynamoRIO</strong></td>
<td>支持内存调试、代码覆盖率统计，模块化接口更灵活</td>
<td>逆向工程、安全检测</td>
</tr>
<tr>
<td><strong>Frida</strong></td>
<td>支持移动端（Android&#x2F;iOS），通过JavaScript脚本快速插桩</td>
<td>App逆向、动态调试</td>
</tr>
</tbody></table>
<h4 id="第2步：编写探针逻辑（以Intel-Pin为例）"><a href="#第2步：编写探针逻辑（以Intel-Pin为例）" class="headerlink" title="第2步：编写探针逻辑（以Intel Pin为例）"></a>第2步：编写探针逻辑（以Intel Pin为例）</h4><p>假设我们要统计程序中所有加法指令的执行次数：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pin.H&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义全局计数器</span></span><br><span class="line">UINT64 addCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入探针代码的函数</span></span><br><span class="line"><span class="function">VOID <span class="title">CountAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    addCount++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测指令是否为加法指令</span></span><br><span class="line"><span class="function">VOID <span class="title">Instruction</span><span class="params">(INS ins, VOID *v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">INS_IsAdd</span>(ins)) &#123; <span class="comment">// 如果是加法指令</span></span><br><span class="line">        <span class="comment">// 在指令执行前插入探针函数</span></span><br><span class="line">        <span class="built_in">INS_InsertCall</span>(ins, IPOINT_BEFORE, (AFUNPTR)CountAdd, IARG_END);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="built_in">PIN_Init</span>(argc, argv);</span><br><span class="line">    <span class="built_in">INS_AddInstrumentFunction</span>(Instruction, <span class="number">0</span>); <span class="comment">// 注册指令级插桩函数</span></span><br><span class="line">    <span class="built_in">PIN_StartProgram</span>(); <span class="comment">// 启动目标程序</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码的作用是：每当程序执行加法指令时，计数器<code>addCount</code>加1 。</p>
<h4 id="第3步：编译与运行"><a href="#第3步：编译与运行" class="headerlink" title="第3步：编译与运行"></a>第3步：编译与运行</h4><ol>
<li><p>编译Pintool（Pin的插桩工具）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入Pin的示例目录</span></span><br><span class="line"><span class="built_in">cd</span> pin-3.11/source/tools/ManualExamples</span><br><span class="line"><span class="comment"># 编译（以64位Linux为例）</span></span><br><span class="line">make obj-intel64/add_counter.so TARGET=intel64</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行目标程序并插桩：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 假设目标程序是test.exe</span></span><br><span class="line">../../../pin -t obj-intel64/add_counter.so -- ./test.exe</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看结果：程序运行结束后，会在终端输出加法指令的总执行次数。</p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Ro1ME</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/03/20/%E7%A8%8B%E5%BA%8F%E6%8F%92%E6%A1%A9/">http://example.com/2025/03/20/程序插桩/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">小小Ro1ME</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/FUZZ/">FUZZ</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/03/19/afl/" title="AFL"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">AFL</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. 程序插桩定义：往被测试程序中插入测试代码以达到测试目的的方法，插入的测试代码被称为探针。 方法：（测试代码插入的时间）  目标代码插桩 源代码插桩  public class MYFirst &#123;	/* 第一个Java程序	 * 打印Hello World	 */	 public static void main(String []args) &#123;	 	System.out.println(&quot;Hello World&quot;);// 打印Hello world	...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Ro1ME</div><div class="author-info-description">进步就是不断地愉悦自己</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">正在努力建设博客中</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E6%8F%92%E6%A1%A9"><span class="toc-number">1.</span> <span class="toc-text">程序插桩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E4%BB%A3%E7%A0%81%E6%8F%92%E6%A1%A9%EF%BC%88%E5%8A%A8%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">目标代码插桩（动态程序分析方法）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">工具示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81%E6%8F%92%E6%A1%A9"><span class="toc-number">1.2.</span> <span class="toc-text">源代码插桩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%E6%8F%92%E6%A1%A9%E5%B7%A5%E5%85%B7"><span class="toc-number">1.3.</span> <span class="toc-text">开源插桩工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%8F%92%E6%A1%A9"><span class="toc-number">1.3.1.</span> <span class="toc-text">动态二进制插桩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%BA%90%E4%BB%A3%E7%A0%81%E6%8F%92%E6%A1%A9"><span class="toc-number">1.3.2.</span> <span class="toc-text">静态源代码插桩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%99%A8%E7%BA%A7%E6%8F%92%E6%A1%A9"><span class="toc-number">1.3.3.</span> <span class="toc-text">编译器级插桩</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%8F%92%E6%A1%A9%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">如何选择插桩方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%8F%92%E6%A1%A9%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.</span> <span class="toc-text">如何使用插桩工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E9%80%89%E6%8B%A9%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.1.</span> <span class="toc-text">第1步：选择工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC2%E6%AD%A5%EF%BC%9A%E7%BC%96%E5%86%99%E6%8E%A2%E9%92%88%E9%80%BB%E8%BE%91%EF%BC%88%E4%BB%A5Intel-Pin%E4%B8%BA%E4%BE%8B%EF%BC%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">第2步：编写探针逻辑（以Intel Pin为例）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC3%E6%AD%A5%EF%BC%9A%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C"><span class="toc-number">1.5.3.</span> <span class="toc-text">第3步：编译与运行</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/20/%E7%A8%8B%E5%BA%8F%E6%8F%92%E6%A1%A9/" title="程序插桩">程序插桩</a><time datetime="2025-03-20T02:46:14.710Z" title="发表于 2025-03-20 10:46:14">2025-03-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/19/afl/" title="AFL">AFL</a><time datetime="2025-03-19T00:51:09.075Z" title="发表于 2025-03-19 08:51:09">2025-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/18/hello-world/" title="Hello World">Hello World</a><time datetime="2025-03-18T02:34:22.610Z" title="发表于 2025-03-18 10:34:22">2025-03-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019-02 - 2025 By Ro1ME</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>